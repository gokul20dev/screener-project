<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Certificate Editor</title>

    <!-- Styles -->
    <link rel="stylesheet" href="./editor.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&family=Inter:wght@400;500;600&family=Montserrat&family=Poppins&family=Open+Sans&family=Lato&family=Oswald&family=Raleway&family=Playfair+Display&family=Nunito&family=Quicksand&family=Merriweather&family=Bebas+Neue&family=Pacifico&family=Dancing+Script&family=Lobster&family=Josefin+Sans&family=Ubuntu&family=Fira+Sans&family=PT+Sans&family=Signika&family=Kalam&family=Courgette&family=Gloria+Hallelujah&family=Great+Vibes&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../../common/commonLibaries/toastr.min.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../common/commonLibaries/cdnjs.cloudflare.com.ajax.libs.fabric.js.5.3.1.fabric.min.js"></script>
  </head>

  <body class="bg-light">
    <div class="editor-container">
      <!-- Left sidetoolbar -->
      <div class="sidetoolbar">
        <div class="tool-group">
          <div class="tool-group-header">
            <span class="tool-group-title">Content</span>
          </div>
          <button
            class="tool-btn text"
            title="Add Text"
            id="addTextBtn"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-font"></i>
          </button>
          <button
            class="tool-btn shape"
            title="Add Shape"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-shapes"></i>
          </button>
          <button
            class="tool-btn background"
            title="Background"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-image"></i>
          </button>
          <button
            class="tool-btn"
            id="addQRCodeBtn"
            title="Add QR Code"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-qrcode"></i>
          </button>
          <button
            class="tool-btn"
            onclick="document.getElementById('imgUpload').click()"
            title="Upload Image"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-upload"></i>
          </button>
          <input type="file" id="imgUpload" accept="image/*" class="d-none" />
          <button
            class="tool-btn borders"
            id="toggleBorderGalleryBtn"
            title="Borders"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-border-style"></i>
          </button>
        </div>

        <div class="tool-group">
          <div class="tool-group-header">
            <span class="tool-group-title">Actions</span>
          </div>
          <button
            class="tool-btn"
            id="undoBtn"
            title="Undo"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-undo"></i>
          </button>
          <button
            class="tool-btn"
            id="redoBtn"
            title="Redo"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-redo"></i>
          </button>
          <button
            class="tool-btn"
            id="saveBtn"
            title="Save"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-save"></i>
          </button>
          <button
            class="tool-btn"
            id="clearbtn"
            title="Clear Canvas"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>

        <div class="tool-group">
          <div class="tool-group-header">
            <span class="tool-group-title">View</span>
          </div>
          <button
            class="tool-btn"
            id="previewBtn"
            title="Preview"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-eye"></i>
          </button>
          <button
            class="tool-btn"
            id="setportraitbtn"
            title="Portrait"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-file-alt"></i>
          </button>
          <button
            class="tool-btn"
            id="setlandscapebtn"
            title="Landscape"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-file fa-rotate-270"></i>
          </button>
        </div>
      </div>

      <!-- Main Canvas Area -->
      <div class="main-content">
        <div class="canvas-area" id="canvasArea">
          <div class="canvas-wrapper" id="canvasWrapper">
            <canvas id="canvas"></canvas>
          </div>
          <div id="qrcode" class="d-none"></div>

          <!-- Mini Map -->
          <div class="mini-map">
            <div class="mini-map-content">
              <canvas id="miniMapCanvas"></canvas>
              <div class="mini-map-viewport"></div>
            </div>
          </div>

          <!-- Zoom Controls -->
          <div class="zoom-controls">
            <button type="button" class="btn" id="zoomOutBtn" title="Zoom Out">
              <i class="fas fa-search-minus"></i>
            </button>
            <div class="zoom-display" id="zoomDisplay">100%</div>
            <button type="button" class="btn" id="zoomInBtn" title="Zoom In">
              <i class="fas fa-search-plus"></i>
            </button>
            <button
              type="button"
              class="btn"
              id="resetZoomBtn"
              title="Reset View"
            >
              <i class="fas fa-expand"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="right-panel">
        <div class="right-panel-content">
          <!-- Text Properties Section -->
          <div class="panel-section text-properties-panel">
            <div class="panel-section-title">Text Properties</div>
            <div class="panel-content">
              <!-- Font Family -->
              <div class="property-group">
                <label>Font Family</label>
                <select id="fontFamilySelect" class="form-select">
                  <!-- Font options will be added dynamically -->
                </select>
              </div>

              <!-- Font Size -->
              <div class="property-group">
                <label>Font Size</label>
                <input
                  type="number"
                  id="fontSizeInput"
                  class="form-control"
                  value="20"
                  min="1"
                  max="300"
                />
              </div>

              <!-- Text Style -->
              <div class="property-group">
                <label>Style</label>
                <div class="btn-group">
                  <button
                    class="btn btn-outline-secondary text-bold"
                    data-action="toggle-bold"
                  >
                    B
                  </button>
                  <button
                    class="btn btn-outline-secondary text-italic"
                    data-action="toggle-italic"
                  >
                    I
                  </button>
                  <button
                    class="btn btn-outline-secondary text-underline"
                    data-action="toggle-underline"
                  >
                    U
                  </button>
                </div>
                <div class="property-group">
                  <div class="btn-group">
                    <button
                      class="btn btn-outline-secondary"
                      id="textTransformUppercase"
                      data-bs-toggle="tooltip"
                      title="Convert to UPPERCASE"
                    >
                      <span class="fs-6 fw-bold">A</span>
                    </button>
                    <button
                      class="btn btn-outline-secondary"
                      id="textTransformLowercase"
                      data-bs-toggle="tooltip"
                      title="Convert to lowercase"
                    >
                      <span class="fs-6">a</span>
                    </button>
                    <button
                      class="btn btn-outline-secondary"
                      id="textTransformCapitalize"
                      data-bs-toggle="tooltip"
                      title="Capitalize First Letter"
                    >
                      <span class="fs-6 text-capitalize">Aa</span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Text Color -->
              <div class="property-group">
                <div class="color-inputs-inline">
                  <div class="color-input-group">
                    <label>Text Color</label>
                    <input
                      type="color"
                      id="fontColorPicker"
                      class="form-control"
                    />
                  </div>
                  <div class="color-input-group">
                    <label>Text BgColor</label>
                    <input
                      type="color"
                      class="form-control"
                      value="#ffffaa"
                      id="textBgColorPicker"
                    />
                  </div>
                </div>
              </div>

              <!-- Text Alignment -->
              <div class="property-group">
                <label>Alignment</label>
                <div class="btn-group">
                  <button
                    class="btn btn-outline-secondary"
                    data-action="align-left"
                  >
                    <i class="fas fa-align-left"></i>
                  </button>
                  <button
                    class="btn btn-outline-secondary"
                    data-action="align-center"
                  >
                    <i class="fas fa-align-center"></i>
                  </button>
                  <button
                    class="btn btn-outline-secondary"
                    data-action="align-right"
                  >
                    <i class="fas fa-align-right"></i>
                  </button>
                </div>
              </div>

              <div class="property-group">
                <label>Letter Spacing</label>
                <input
                  type="range"
                  id="letterSpacingInput"
                  min="0"
                  max="10"
                  step="0.5"
                  value="0"
                  class="form-range w-100"
                />
                <label>Line Height</label>
                <input
                  type="range"
                  id="lineHeightInput"
                  min="0.5"
                  max="10"
                  step="0.1"
                  value="1.2"
                  class="form-range w-100"
                />
              </div>

              <div class="property-group">
                <label>Text Shadow</label>
                <input
                  type="range"
                  id="textShadowInput"
                  min="0"
                  max="20"
                  step="0.2"
                  value="0"
                  class="form-range w-100"
                />
              </div>

              <div class="property-group">
                <div class="color-inputs-inline">
                  <div class="color-input-group">
                    <label>Text shadow color</label>
                    <input
                      type="color"
                      class="form-control form-control-color"
                      value="#ffffff"
                      id="textShadowColorPicker"
                    />
                  </div>
                  <div class="color-input-group">
                    <label>Text stroke color</label>
                    <input
                      type="color"
                      class="form-control form-control-color"
                      value="#ffffff"
                      id="textStrokeColorPicker"
                    />
                  </div>
                </div>
              </div>

              <div class="property-group">
                <label>Stroke Width</label>
                <input
                  type="range"
                  id="strokeWidth"
                  min="0"
                  max="20"
                  step="0.1"
                  value="0"
                  class="form-range w-100"
                />
              </div>
            </div>
          </div>
          <!-- Shape Properties -->
          <div class="panel-section shape-properties-panel">
            <div class="panel-section-title">Shapes</div>
            <div class="panel-content">
              <div class="property-group">
                <div class="color-inputs-inline">
                  <div class="color-input-group">
                    <label>Fill Color</label>
                    <input
                      type="color"
                      id="shapeFillColor"
                      value="#ffffff"
                      class="form-control form-control-color"
                    />
                  </div>
                  <div class="color-input-group">
                    <label>Border Color</label>
                    <input
                      type="color"
                      id="shapeStrokeColor"
                      value="#000000"
                      class="form-control form-control-color"
                    />
                  </div>
                </div>
              </div>
              <div class="property-group">
                <button
                  data-action="add-rectangle"
                  title="Rectangle"
                  class="btn btn-sm btn-light"
                >
                  <i class="fas fa-square"></i>
                </button>
                <button
                  data-action="add-circle"
                  title="Circle"
                  class="btn btn-sm btn-light"
                >
                  <i class="fas fa-circle"></i>
                </button>
                <button
                  data-action="add-triangle"
                  title="Triangle"
                  class="btn btn-sm btn-light"
                >
                  <i class="fas fa-play"></i>
                </button>
                <button
                  data-action="add-polygon"
                  title="Polygon"
                  class="btn btn-sm btn-light"
                >
                  <i class="fas fa-draw-polygon"></i>
                </button>
              </div>
              <div class="property-group">
                <label class="form-label">Border Width</label>
                <div class="d-flex align-items-center gap-2">
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    id="addPageBorderBtn"
                    title="Add Border"
                  >
                    <i class="fas fa-border-all"></i>
                  </button>
                  <input
                    type="range"
                    id="shapeStrokeWidth"
                    min="1"
                    max="40"
                    value="2"
                    class="form-range"
                    title="Shape Border Width"
                    style="flex-grow: 1"
                  />
                </div>
              </div>
              <div class="property-group">
                <label class="form-label">Toggle Grid</label>
                <div class="d-flex align-items-center gap-2">
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    id="addToggleGridBtn"
                    title="Toggle Grid"
                  >
                    <i class="fas fa-th me-2"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- Background -->
          <div class="panel-section background-properties-panel">
            <div class="panel-section-title">Background Properties</div>
            <div class="panel-content">
              <!-- === Background Color === -->
              <div class="property-group">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="form-label fw-bold mb-0"
                    >Background Color</label
                  >
                  <button
                    class="btn btn-sm border-0"
                    id="clearBgcolor"
                    title="Clear Background Color"
                  >
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <input
                  type="color"
                  id="bgColorPicker"
                  class="form-control form-control-color w-100 mt-1"
                  title="Choose background color"
                />
              </div>

              <!-- === Gradient Background === -->
              <div class="property-group mt-3">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="form-label fw-bold mb-0"
                    >Gradient Background</label
                  >
                  <button
                    class="btn btn-sm border-0"
                    id="clearBGgradient"
                    title="Clear Gradient"
                  >
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <select class="form-select mt-1 mb-2" id="gradientType">
                  <option value="">Select Type</option>
                  <option value="linear">Linear Gradient</option>
                  <option value="radial">Radial Gradient</option>
                </select>
                <div class="d-flex justify-content-between gap-2 mb-2">
                  <div class="color-input-group">
                    <label>Start Color</label>
                    <input
                      type="color"
                      id="gradientColor1"
                      value="#ffffff"
                      class="form-control form-control-color flex-fill"
                    />
                  </div>
                  <div class="color-input-group">
                    <label>End Color</label>
                    <input
                      type="color"
                      id="gradientColor2"
                      value="#0000ff"
                      class="form-control form-control-color flex-fill"
                    />
                  </div>
                </div>
              </div>

              <!-- === Background Image === -->
              <div class="property-group mt-3">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="form-label fw-bold mb-0"
                    >Background Image</label
                  >
                  <button
                    class="btn btn-sm border-0"
                    id="clearbgImage"
                    title="Clear Background Image"
                  >
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <button
                  class="btn w-100 mt-1 btn-outline-primary"
                  onclick="document.getElementById('bgUpload').click()"
                  title="Upload Background Image"
                >
                  <i class="fas fa-image me-2"></i> Upload
                </button>
                <input
                  type="file"
                  id="bgUpload"
                  accept="image/*"
                  style="display: none"
                />
                <div id="bgPreviewWrapper" class="mt-2 text-center d-none">
                  <img
                    id="bgPreview"
                    src=""
                    class="img-fluid rounded border"
                    style="max-height: 120px"
                    alt="Preview"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Border Gallery -->
          <div class="panel-section bordergallery-properties-panel">
            <div
              class="panel-section-title d-flex justify-content-between align-items-center"
            >
              <span>Border Gallery</span>
              <button
                class="btn btn-sm"
                id="hideBorderGalleryPanel"
                title="Clear Border"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="panel-content">
              <div id="borderGalleryList" class="d-flex flex-wrap gap-2">
                <!-- Border images will be dynamically inserted here -->
              </div>
            </div>
          </div>

          <!-- Dynamic Placeholders Section (moved below, hidden by default) -->
          <div class="panel-section dynamic-placeholders-section">
            <div
              class="panel-section-title d-flex align-items-center justify-content-between"
            >
              <span>Dynamic Placeholders</span>
            </div>
            <div class="dynamic-placeholders">
              <div class="placeholder-item" data-placeholder="@Candidate Name">
                <i class="fas fa-font"></i>
                <span>Candidate Name</span>
              </div>
              <div class="placeholder-item" data-placeholder="@Score">
                <i class="fas fa-font"></i>
                <span>Score</span>
              </div>
              <div class="placeholder-item" data-placeholder="@Out Of">
                <i class="fas fa-font"></i>
                <span>Out Of</span>
              </div>
              <div class="placeholder-item" data-placeholder="@Percentage">
                <i class="fas fa-font"></i>
                <span>Percentage</span>
              </div>
              <div class="placeholder-item" data-placeholder="@Exam Name">
                <i class="fas fa-font"></i>
                <span>Exam Name</span>
              </div>
              <div class="placeholder-item" data-placeholder="@Course Name">
                <i class="fas fa-font"></i>
                <span>Course Name</span>
              </div>
              <div class="placeholder-item" data-placeholder="@Program Name">
                <i class="fas fa-font"></i>
                <span>Program Name</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right-click Context Menu -->
    <div id="contextMenu" class="contextmenu">
      <!-- Quick Actions -->
      <div class="context-section">
        <div class="context-section-title">Quick Actions</div>
        <div class="context-actions-grid">
          <a
            class="dropdown-item"
            href="#"
            id="deselect"
            data-bs-toggle="tooltip"
            title="Deselect"
          >
            <i class="fas fa-ban"></i>
            <span>Deselect</span>
          </a>
          <a
            class="dropdown-item"
            href="#"
            id="cutBtn"
            data-bs-toggle="tooltip"
            title="Cut"
          >
            <i class="fas fa-cut"></i>
            <span>Cut</span>
          </a>
          <a
            class="dropdown-item"
            href="#"
            id="copyBtn"
            data-bs-toggle="tooltip"
            title="Copy"
          >
            <i class="fas fa-copy"></i>
            <span>Copy</span>
          </a>
          <a
            class="dropdown-item"
            href="#"
            id="pasteBtn"
            data-bs-toggle="tooltip"
            title="Paste"
          >
            <i class="fas fa-paste"></i>
            <span>Paste</span>
          </a>
          <a
            class="dropdown-item delete-item"
            href="#"
            id="deleteBtn"
            title="Delete"
            data-bs-toggle="tooltip"
          >
            <i class="fas fa-trash"></i>
            <span>Delete</span>
          </a>
        </div>
      </div>

      <div class="dropdown-divider"></div>

      <!-- Grouping -->
      <div class="context-section">
        <div class="context-section-title">Grouping</div>
        <div class="context-actions-row">
          <a
            class="dropdown-item"
            href="#"
            id="btnGroup"
            data-bs-toggle="tooltip"
            title="Group Selected Objects"
          >
            <i class="fas fa-object-group"></i>
            <span>Group</span>
          </a>
          <a
            class="dropdown-item"
            href="#"
            id="btnUngroup"
            data-bs-toggle="tooltip"
            title="Ungroup Selected Objects"
          >
            <i class="fas fa-object-ungroup"></i>
            <span>Ungroup</span>
          </a>
        </div>
      </div>

      <div class="dropdown-divider"></div>

      <!-- Layer Order -->
      <div class="context-section">
        <div class="context-section-title">Layer Order</div>
        <div class="context-actions-row">
          <a
            class="dropdown-item"
            href="#"
            id="btnForward"
            data-bs-toggle="tooltip"
            title="Bring Forward"
          >
            <i class="fas fa-arrow-up"></i>
            <span>Forward</span>
          </a>
          <a
            class="dropdown-item"
            href="#"
            id="btnBackward"
            data-bs-toggle="tooltip"
            title="Send Backward"
          >
            <i class="fas fa-arrow-down"></i>
            <span>Backward</span>
          </a>
        </div>
      </div>

      <div class="dropdown-divider"></div>

      <!-- Opacity Control -->
      <div class="context-section">
        <div class="context-section-title">Opacity</div>
        <div class="opacity-control">
          <input
            type="range"
            min="0"
            max="1"
            step="0.1"
            class="form-range"
            id="opacityRange"
            value="1"
          />
          <span class="opacity-value">100%</span>
        </div>
      </div>

      <div class="dropdown-divider"></div>

      <!-- Transform -->
      <div class="context-section">
        <div class="context-section-title">Transform</div>
        <div class="context-actions-row">
          <button
            class="dropdown-item"
            id="rotateCW"
            data-bs-toggle="tooltip"
            title="Rotate Clockwise"
          >
            <i class="fas fa-rotate-right"></i>
            <span>Rotate CW</span>
          </button>
          <button
            class="dropdown-item"
            id="rotateACW"
            data-bs-toggle="tooltip"
            title="Rotate Anti-Clockwise"
          >
            <i class="fas fa-rotate-left"></i>
            <span>Rotate ACW</span>
          </button>
        </div>
        <div class="context-actions-row">
          <button
            class="dropdown-item"
            id="flipX"
            data-bs-toggle="tooltip"
            title="Flip Horizontally"
          >
            <i class="fas fa-arrows-left-right"></i>
            <span>Flip X</span>
          </button>
          <button
            class="dropdown-item"
            id="flipY"
            data-bs-toggle="tooltip"
            title="Flip Vertically"
          >
            <i class="fas fa-arrows-up-down"></i>
            <span>Flip Y</span>
          </button>
        </div>
      </div>

      <div class="dropdown-divider"></div>

      <!-- Lock/Unlock -->
      <div class="context-section">
        <button
          class="dropdown-item"
          id="lockUnlock"
          data-bs-toggle="tooltip"
          title="Lock/Unlock"
        >
          <i class="fas fa-lock"></i>
          <span>Lock/Unlock</span>
        </button>
      </div>
    </div>

    <!-- Save Template Modal -->
    <script id="save-template-modal-template" type="text/x-handlebars-template">
      <div
        class="modal fade"
        id="saveTemplateModal"
        tabindex="-1"
        aria-labelledby="saveTemplateModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title" id="saveTemplateModalLabel">Save
                Certificate</h5>
              <button
                type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="templateTitle" class="form-label">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="templateTitle"
                  value="{{title}}"
                  placeholder="Certificate Title"
                />
              </div>
              <div class="mb-3">
                <label
                  for="templateDescription"
                  class="form-label"
                >Description</label>
                <textarea
                  class="form-control"
                  id="templateDescription"
                  rows="3"
                  placeholder="Certificate Description"
                >{{description}}</textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >Cancel</button>
              <button
                type="button"
                class="btn btn-primary"
                id="confirmSaveTemplate"
              >Save</button>
            </div>
          </div>
        </div>
      </div>
    </script>

    <!-- Scripts -->
    <script src="../../common/commonLibaries/jquery-3.6.0.min.js"></script>
    <script src="../../common/commonLibaries/toastr.min.js"></script>
    <script src="../../common/js/common.js"></script>
    <script src="../../common/commonLibaries/cdn.jsdelivr.net.npm.@popperjs.core@2.11.8.dist.umd.popper.min.js"></script>
    <script src="../../common/commonLibaries/bootstrap.min.js"></script>
    <script src="../../common/commonLibaries/cdnjs.cloudflare.com.ajax.libs.qrcodejs.1.0.0.qrcode.min.js"></script>
    <script src="../../common/commonLibaries/htmleditor//dist/trumbowyg.min.js"></script>
    <script src="../../common/js/variable.js"></script>
    <script src="../../fullscreenexam/cloud-service/aws.service.js"></script>
    <script src="../../common/js/loader.js"></script>
    <script src="../../common/js/commonApi.js"></script>
    <script src="./editor.js" type="text/javascript"></script>
  </body>
</html>
